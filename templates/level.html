<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CTF Level {{ level }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div class="container">

    <header>
        <h1>CTF :: LEVEL {{ level }}  :: {{ header }}</h1>
        <span class="status">points: {{ user_points }} (nr. {{ user_rank }} out of {{ number_of_players }} players)CONNECTED</span>
    </header>

    <section class="challenge">
        <pre class="question">{{ question|safe }}</pre> 
        
        <form method="POST">
            <input type="text" name="flag" placeholder="ENTER FLAG..." required>
            <button type="submit">SUBMIT</button>
        </form>

        <!-- Hint Section -->
        <div class="hint-box">
            <button class="hint-btn" onclick="toggleHint()">{{ '▼ Hide Hint' if hint_shown else '▶ Show Hint' }}</button>
            <div id="hint" class="hint-content" style="{{ 'display:block;' if hint_shown else 'display:none;' }}">
                <pre>{{ hint|safe }}</pre>
            </div>
        </div>
    </section>

    <!-- Log Console -->
    <section class="log-console">
        <div class="log-title">SYSTEM LOG</div>
        <div class="log-content">
            {{ logs|safe }}
        </div>
    </section>

    <footer>
        <a href="/logout">DISCONNECT</a>
    </footer>

</div>

<script>
function toggleHint() {
    const hint = document.getElementById("hint");
    const btn = document.querySelector(".hint-btn");

    if (hint.style.display === "block") {
        hint.style.display = "none";
        btn.innerText = "▶ Show Hint";
    } else {
        hint.style.display = "block";
        btn.innerText = "▼ Hide Hint";
        // notify server that the hint was used (records log + points)
        fetch("{{ url_for('hint_used') }}", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ level: {{ level }} })
        }).then(res => res.json()).then(data => {
            if (data.status !== 'ok') {
                console.error('Hint logging error', data);
            } else {
                // reload to update log and points
                window.location.reload();
            }
        }).catch(err => console.error('Hint logging failed', err));
    }
}
</script>

</body>
</html>

